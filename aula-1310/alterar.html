<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Alterar Pergunta</title>
<script>
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        if (id) {
            document.getElementById("idBusca").value = id;
            EnviarIdPergunta();
        }
    };

    function EnviarIdPergunta() {
        let id = document.getElementById("idBusca").value.trim();

        if (id === "") {
            document.getElementById("msg").innerHTML = "Digite um ID válido!";
            return;
        }

        let xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    try {
                        const objReturnJSON = JSON.parse(this.responseText);
                        
                        if (objReturnJSON.id && objReturnJSON.pergunta) {
                            document.getElementById("id").value = objReturnJSON.id;
                            document.getElementById("pergunta").value = objReturnJSON.pergunta;
                            document.getElementById("tipo").value = objReturnJSON.tipo;
                            document.getElementById("mdForm").style.display = "block";
                            document.getElementById("msg").innerHTML = "Pergunta encontrada!";
                        } else {
                            document.getElementById("mdForm").style.display = "none";
                            document.getElementById("msg").innerHTML = "Pergunta não encontrada.";
                        }

                    } catch (e) {
                        console.error("Erro ao processar JSON:", e, this.responseText);
                        document.getElementById("msg").innerHTML = "Erro ao buscar a pergunta.";
                    }
                } else {
                    document.getElementById("msg").innerHTML = "Erro na requisição: " + this.status;
                }
            }
        }

        xmlhttp.open("GET", "Buscar.php?id=" + encodeURIComponent(id), true);
        xmlhttp.send();
    }

    function EnviarPergunta() {
        let id = document.getElementById("id").value.trim();
        let pergunta = document.getElementById("pergunta").value.trim();
        let tipo = document.getElementById("tipo").value.trim();

        if (id === "" || pergunta === "" || tipo === "") {
            document.getElementById("msg").innerHTML = "Preencha todos os campos!";
            return;
        }

        let xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    document.getElementById("msg").innerHTML = this.responseText;
                } else {
                    document.getElementById("msg").innerHTML = "Erro ao salvar alterações: " + this.status;
                }
            }
        }

        xmlhttp.open("POST", "Alterar.php", true);
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(
            "id=" + encodeURIComponent(id) +
            "&pergunta=" + encodeURIComponent(pergunta) +
            "&tipo=" + encodeURIComponent(tipo)
        );
    }
</script>

</head>
<body>

<h1>Alterar Pergunta</h1>

<div>
    <form id="formIdPergunta">
        <label>Digite o ID da Pergunta:</label><br>
        <input type="text" id="idBusca" required>
        <input type="button" value="Buscar" onclick="EnviarIdPergunta();">
    </form>
</div>

<a href="listar.php"><p>Não me Lembro do ID: Listar todas perguntas aqui</p></a>

<div id="mdForm" style="display:none;">
    <h3>Editar Pergunta</h3>
    <form id="formPergunta">
        Id: <input type="text" id="id" readonly><br>
        Pergunta: <input type="text" id="pergunta"><br>
        Tipo: <input type="text" id="tipo"><br><br>
        <input type="button" value="Salvar Alteração" onclick="EnviarPergunta();">
    </form>
</div>

<p id="msg"></p>

</body>
</html>
